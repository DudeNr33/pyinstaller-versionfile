[tox]
envlist = {py27,py36}-tests

[testenv]
skip_install =
    lint: true

deps =
    {tests,cov}:    -r {toxinidir}/requirements.txt
    {tests,cov}:    pytest
    win:            pywin32
    cov:            coverage
    cov:            pytest-cov

    lint:           flake8
    lint:           flake8-junit-report

    build:          setuptools
    build:          check-manifest>=0.42

whitelist_externals =
    cmd

passenv =
    includeE2E

commands_pre =
    build:          cmd /c if exist build del /s /q build
    build:          cmd /c if exist dist del /s /q dist

commands =
    tests:          pytest \
    tests-cov:          --cov={envsitepackagesdir}/pyinstaller_versionfile \
    tests-cov:          --cov-branch \
    tests-cov:          --cov-report=html:{envtmpdir}/testresults/htmlcov \
    tests:              --junitxml={envtmpdir}/testresults/junit.{envname}.xml \
    tests:              --junit-prefix={envname} \
    tests:              {posargs:test}

    lint:           flake8 src/ --output-file={envtmpdir}/flake8report.txt

commands_post =
    lint:           flake8_junit {envtmpdir}/flake8report.txt {envtmpdir}/flake8junit.xml

# Pytest configuration
[pytest]
junit_family = xunit2

# Coverage measurement configuration
[coverage:run]
source = ./src
omit =
    */_empty
    */docs/*
    */*.txt
    */*.md
    */setup.py
    */LICENSE

# Flake8 configuration
[flake8]
max-line-length = 120
max-complexity = 10

# check_manifest configuration
[check-manifest]
ignore =
    docs/_build/**
